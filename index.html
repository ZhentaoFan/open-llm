<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Zhentao Fan | Works</title>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600&family=Source+Serif+4:opsz,wght@8..60,500;8..60,600&display=swap");

      :root {
        --bg: #ffffff;
        --text: #1f2937;
        --muted: #5b6473;
        --line: #e5e7eb;
        --link: #1f4fa5;
        --panel: #fafbfc;
      }

      * {
        box-sizing: border-box;
      }

      html {
        scroll-behavior: smooth;
      }

      body {
        margin: 0;
        background: var(--bg);
        color: var(--text);
        font-family: "IBM Plex Sans", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif;
        line-height: 1.75;
      }

      .page {
        width: min(940px, 92vw);
        margin: 30px auto 68px;
      }

      .topbar {
        display: flex;
        align-items: flex-start;
        justify-content: space-between;
        gap: 20px;
        border-bottom: 1px solid var(--line);
        padding: 10px 0 14px;
      }

      .identity {
        display: flex;
        flex-direction: column;
        gap: 2px;
      }

      .brand {
        font-family: "Source Serif 4", "Songti SC", serif;
        font-size: 1.4rem;
        font-weight: 600;
        letter-spacing: 0.2px;
      }

      .identity-contact {
        color: var(--muted);
        font-size: 0.92rem;
        line-height: 1.5;
      }

      .identity-contact a {
        color: var(--link);
        text-decoration: none;
      }

      .identity-contact a:hover {
        text-decoration: underline;
      }

      .topbar nav {
        display: flex;
        gap: 18px;
        flex-wrap: wrap;
      }

      .topbar nav a {
        color: var(--muted);
        text-decoration: none;
        font-size: 0.95rem;
      }

      .topbar nav a:hover {
        color: var(--link);
      }

      .hero {
        padding: 10px 0 8px;
      }

      .hero h2 {
        margin: 0;
        font-family: "Source Serif 4", "Songti SC", serif;
        font-size: clamp(1.5rem, 4.2vw, 2rem);
        line-height: 1.15;
        font-weight: 600;
      }

      .hero p {
        margin: 14px 0 0;
        max-width: 76ch;
        color: var(--muted);
      }

      .section-title {
        margin: 10px 0 8px;
        font-family: "Source Serif 4", "Songti SC", serif;
        font-size: clamp(1.2rem, 3vw, 1.35rem);
        font-weight: 600;
      }

      .pending-fold {
        border-top: 1px solid var(--line);
      }

      .pending-summary {
        align-items: center;
      }

      .pending-summary .section-title {
        margin: 0;
      }

      .pending-summary .toggle-mark {
        margin-right: 12px;
      }

      .works-intro {
        margin: 0 0 8px;
        color: var(--muted);
      }

      .works {
        border-top: 1px solid var(--line);
      }

      .work-entry {
        padding: 16px 0;
        border-bottom: 1px solid var(--line);
      }

      summary {
        list-style: none;
        cursor: pointer;
        padding: 16px 0;
        display: flex;
        align-items: baseline;
        justify-content: space-between;
        gap: 16px;
      }

      summary::-webkit-details-marker {
        display: none;
      }

      .work-title-wrap {
        min-width: 0;
      }

      .work-title {
        font-size: 1.05rem;
        font-weight: 600;
        color: var(--text);
      }

      .work-date {
        color: #9ca3af;
        font-weight: 500;
      }

      .work-desc {
        margin-top: 4px;
        color: var(--muted);
        font-size: 0.95rem;
      }

      .work-desc a {
        color: #6b7280;
        text-decoration: underline;
      }

      .work-desc a:hover {
        color: #4b5563;
        text-decoration: underline;
      }

      .file-list {
        margin-top: 8px;
      }

      details.file-item {
        border: 1px solid var(--line);
        border-radius: 8px;
        background: #fff;
      }

      details.file-item + details.file-item {
        margin-top: 10px;
      }

      details.file-item summary {
        padding: 10px 12px;
      }

      .file-name {
        font-size: 0.95rem;
        color: #6b7280;
        word-break: break-all;
      }

      .toggle-mark {
        flex: 0 0 auto;
        color: #9ca3af;
        font-size: 0;
        line-height: 0;
        width: 14px;
        height: 14px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        transition: transform 0.2s ease;
      }

      .toggle-mark::before {
        content: "";
        width: 0;
        height: 0;
        border-top: 5px solid transparent;
        border-bottom: 5px solid transparent;
        border-left: 8px solid currentColor;
      }

      details[open] .toggle-mark {
        transform: rotate(90deg);
      }

      .pdf-viewer {
        width: auto;
        margin: 0 12px 12px;
        border: 1px solid #d8dce3;
        border-radius: 8px;
        background: #fff;
        padding: 10px;
        min-height: 120px;
        overflow: hidden;
      }

      .pdf-status {
        margin: 0;
        color: #6b7280;
        font-size: 0.9rem;
      }

      .pdf-page {
        margin-top: 10px;
        border: 1px solid #e5e7eb;
        border-radius: 6px;
        overflow: hidden;
        background: #fff;
        max-width: 100%;
      }

      .pdf-page canvas {
        display: block;
        width: 100%;
        height: auto;
      }

      .asset-image {
        display: block;
        width: 100%;
        max-width: 100%;
        height: auto;
        margin-top: 10px;
        border: 1px solid #e5e7eb;
        border-radius: 6px;
        background: #fff;
      }

      .pdf-fallback {
        margin: 10px 0 0;
        font-size: 0.9rem;
      }

      .pdf-fallback a {
        color: #6b7280;
        text-decoration: underline;
      }

      .back-to-top {
        position: fixed;
        right: 128px;
        bottom: 22px;
        width: 46px;
        height: 46px;
        border: 1px solid #d1d5db;
        border-radius: 999px;
        background: #ffffff;
        color: #6b7280;
        font-size: 1.15rem;
        line-height: 1;
        display: grid;
        place-items: center;
        box-shadow: 0 8px 20px rgba(17, 24, 39, 0.12);
        cursor: pointer;
        opacity: 1;
        transform: none;
        pointer-events: auto;
        transition: color 0.2s ease;
        z-index: 20;
      }

      .back-to-top svg {
        width: 20px;
        height: 20px;
        display: block;
      }

      .back-to-top:hover {
        color: #374151;
      }

      @media (max-width: 760px) {
        .page {
          margin-top: 18px;
        }

        .topbar {
          flex-direction: column;
          align-items: flex-start;
          gap: 8px;
        }

        .back-to-top {
          right: 24px;
          bottom: 14px;
        }
      }
    </style>
  </head>
  <body>
    <main class="page">
      <header class="topbar">
        <div class="identity">
          <div class="brand">Zhentao Fan</div>
          <div class="identity-contact" id="contact">
            多伦多大学本硕，两年修满学分，本科生讲师
          </div>
          <div class="identity-contact" id="contact">
            Contact:
            <a href="mailto:zhentao.fan@alumni.utoronto.ca">zhentao.fan@alumni.utoronto.ca</a>
          </div>
        </div>
        <nav aria-label="Main">
          <a href="#about">About</a>
          <a href="#works">Works</a>
          <a href="#contact">Contact</a>
        </nav>
      </header>

      <section class="hero" id="about">
        <h2>Open-Sourced Innovation</h2>
        <!-- <p>
          研究方向：
          训练并行框架，算子优化，长程多轮RL
        </p> -->
      </section>

      <section id="works">
        <h2 class="section-title">已落产品工作</h2>
        <!-- <p class="works-intro">占位符。</p> -->

        <div class="works">
          <article class="work-entry">
            <div class="work-title-wrap">
              <div class="work-title">【创新｜独作】Mamba Context Parallel <span class="work-date">[2025/05｜华为加研院TechSpark年度创新银奖]</span></div>
              <div class="work-desc">Mamba2 上下文并行算法： 预训练加速10%～20%，无限上下文训练，可与现有TPSP方法叠加。<a href="https://gitcode.com/Ascend/MindSpeed-LLM/blob/2.3.0/mindspeed_llm/tasks/models/ssm/state_space_context_parallel.py" target="_blank" rel="noopener">[代码]</a></div>
            </div>
            <div class="file-list">
              <details class="file-item">
                <summary>
                  <span class="file-name" data-from-src></span>
                  <span class="toggle-mark">▶</span>
                </summary>
                <div class="pdf-viewer" data-pdf-src="./MambaCP特性讲解.pdf">
                  <p class="pdf-status">展开后加载 PDF 预览...</p>
                </div>
              </details>
            </div>
          </article>

          <article class="work-entry">
            <div class="work-title-wrap">
              <div class="work-title">【优化｜合著】昇腾 MLA PageAttention Int8算子 <span class="work-date">[2025/04]</span></div>
              <div class="work-desc">MLA推理算子：C8算子加速160%，16比特算子加速20%。<a href="https://gitcode.com/cann/ascend-transformer-boost/blob/br_release_cann_8.3.RC1_20260322/src/kernels/mixkernels/multi_latent_attention/op_kernel/mla_int8.cce" target="_blank" rel="noopener">[代码]</a></div>
            </div>
            <div class="file-list">
              <details class="file-item">
                <summary>
                  <span class="file-name" data-from-src></span>
                  <span class="toggle-mark">▶</span>
                </summary>
                <div class="pdf-viewer" data-pdf-src="./DeepSeek-C8优化讲解.pdf">
                  <p class="pdf-status">展开后加载 PDF 预览...</p>
                </div>
              </details>
              <details class="file-item">
                <summary>
                  <span class="file-name" data-from-src></span>
                  <span class="toggle-mark">▶</span>
                </summary>
                <div class="pdf-viewer" data-pdf-src="./MLA-PageAtten-MTP优化讲解.pdf">
                  <p class="pdf-status">展开后加载 PDF 预览...</p>
                </div>
              </details>
            </div>
          </article>

          <article class="work-entry">
            <div class="work-title-wrap">
              <div class="work-title">【创新｜独作】ZeCO-HDP <span class="work-date">[2025/12]</span></div>
              <div class="work-desc">RL场景，长短序列混合CP并行：训练后端加速10～20%，峰值Tokens负载更低。<a href="https://gitcode.com/cann/cann-recipes-train/pull/89" target="_blank" rel="noopener">[代码]</a></div>
            </div>
            <div class="file-list">
              <details class="file-item">
                <summary>
                  <span class="file-name" data-from-src></span>
                  <span class="toggle-mark">▶</span>
                </summary>
                <div class="pdf-viewer" data-pdf-src="./ZeCO-HDP优化讲解.pdf">
                  <p class="pdf-status">展开后加载 PDF 预览...</p>
                </div>
              </details>
            </div>
          </article>

        </div>
      </section>

      <section id="pending-works">
        <details class="pending-fold">
          <summary class="pending-summary">
            <h2 class="section-title">未落产品工作</h2>
            <span class="toggle-mark">▶</span>
          </summary>
          <div class="works">
            <article class="work-entry">
              <div class="work-title-wrap">
                <div class="work-title">【创新｜独作】StereoDiT <span class="work-date">[2025/09]</span></div>
                <div class="work-desc">任意视频推理出3D双目视频：效果不错，稳定性低，难产品化。</div>
              </div>
              <div class="file-list">
                <details class="file-item">
                  <summary>
                    <span class="file-name" data-from-src></span>
                    <span class="toggle-mark">▶</span>
                  </summary>
                  <div class="pdf-viewer" data-pdf-src="./StereoDiT.pdf">
                    <p class="pdf-status">展开后加载 PDF 预览...</p>
                  </div>
                </details>
              </div>
            </article>

            <article class="work-entry">
              <div class="work-title-wrap">
                <div class="work-title">【创新｜合著】TaoCache <span class="work-date">[2025/08]</span></div>
                <div class="work-desc">视频生成推理加速：物体结构保持性好，加速上限低。</div>
              </div>
              <div class="file-list">
                <details class="file-item">
                  <summary>
                    <span class="file-name" data-from-src></span>
                    <span class="toggle-mark">▶</span>
                  </summary>
                  <div class="pdf-viewer" data-pdf-src="./TaoCache.pdf">
                    <p class="pdf-status">展开后加载 PDF 预览...</p>
                  </div>
                </details>
              </div>
            </article>

            <article class="work-entry">
              <div class="work-title-wrap">
                <div class="work-title">【创新｜独作】SwapDual <span class="work-date">[2025/02]</span></div>
                <div class="work-desc">VPP反向阶段前置Stage1的权重更新并Swap至互补rank的卡上，提前下一轮前向减少空泡：对现有产品框架入侵大。</div>
              </div>
              <div class="file-list">
                <details class="file-item">
                  <summary>
                    <span class="file-name" data-from-src></span>
                    <span class="toggle-mark">▶</span>
                  </summary>
                  <div class="pdf-viewer" data-pdf-src="./SwapDual.png">
                    <p class="pdf-status">展开后加载 PDF 预览...</p>
                  </div>
                </details>
              </div>
            </article>

            <article class="work-entry">
              <div class="work-title-wrap">
                <div class="work-title">【优化｜独作】Matmul Optimization <span class="work-date">[2025/02]</span></div>
                <div class="work-desc">
                  优化Swizzle策略提升910B卡型上大矩阵L2 Cache命中：后续转交其他部门。</div>
              </div>
              <div class="file-list">
                <details class="file-item">
                  <summary>
                    <span class="file-name" data-from-src></span>
                    <span class="toggle-mark">▶</span>
                  </summary>
                  <div class="pdf-viewer" data-pdf-src="./MatmulSwizzling.png">
                    <p class="pdf-status">展开后加载 PDF 预览...</p>
                  </div>
                </details>
              </div>
            </article>
          </div>
        </details>
      </section>
    </main>
    <button class="back-to-top" id="backToTop" type="button" aria-label="回到顶部" title="回到顶部">
      <svg viewBox="0 0 24 24" aria-hidden="true">
        <path
          d="M12 18V6M12 6L7 11M12 6L17 11"
          fill="none"
          stroke="currentColor"
          stroke-width="3"
          stroke-linecap="round"
          stroke-linejoin="round"
        />
      </svg>
    </button>

    <script>
      const getFileNameFromSrc = (src) => {
        const path = (src || "").split("#")[0].split("?")[0];
        const tail = path.substring(path.lastIndexOf("/") + 1);
        try {
          return decodeURIComponent(tail);
        } catch {
          return tail;
        }
      };

      const getPdfSrc = (viewer) => viewer.getAttribute("data-pdf-src") || "";
      const getFileExt = (src) => {
        const path = (src || "").split("#")[0].split("?")[0];
        const dot = path.lastIndexOf(".");
        return dot === -1 ? "" : path.slice(dot + 1).toLowerCase();
      };
      const isImageExt = (ext) => ["png", "jpg", "jpeg", "webp", "gif", "bmp", "svg"].includes(ext);

      let pdfJsLoader;
      const loadPdfJs = () => {
        if (window.pdfjsLib) return Promise.resolve(window.pdfjsLib);
        if (!pdfJsLoader) {
          pdfJsLoader = new Promise((resolve, reject) => {
            const script = document.createElement("script");
            script.src = "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js";
            script.onload = () => {
              if (!window.pdfjsLib) {
                reject(new Error("PDF.js is unavailable"));
                return;
              }
              window.pdfjsLib.GlobalWorkerOptions.workerSrc =
                "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";
              resolve(window.pdfjsLib);
            };
            script.onerror = () => reject(new Error("Failed to load PDF.js"));
            document.head.appendChild(script);
          });
        }
        return pdfJsLoader;
      };

      const createFallbackLink = (viewer, src, fileName) => {
        if (viewer.querySelector(".pdf-fallback")) return;
        const row = document.createElement("p");
        row.className = "pdf-fallback";
        const link = document.createElement("a");
        link.href = src;
        link.target = "_blank";
        link.rel = "noopener";
        link.textContent = `打开 ${fileName}`;
        row.appendChild(link);
        viewer.appendChild(row);
      };

      const clearViewer = (viewer) => {
        viewer.querySelectorAll(".pdf-page").forEach((node) => node.remove());
        viewer.querySelectorAll(".asset-image").forEach((node) => node.remove());
        viewer.querySelectorAll(".pdf-fallback").forEach((node) => node.remove());
      };

      const renderPreview = async (viewer) => {
        if (viewer.dataset.renderState === "loading" || viewer.dataset.renderState === "done") return;
        const src = getPdfSrc(viewer);
        if (!src) return;
        const ext = getFileExt(src);
        const fileName = getFileNameFromSrc(src);

        const status = viewer.querySelector(".pdf-status");
        const setStatus = (text) => {
          if (!status) return;
          status.textContent = text;
          status.hidden = false;
        };

        viewer.dataset.renderState = "loading";
        clearViewer(viewer);

        if (isImageExt(ext)) {
          setStatus("图片加载中...");
          const img = new Image();
          img.className = "asset-image";
          img.loading = "lazy";
          img.decoding = "async";
          img.alt = fileName;
          let finished = false;
          const imageTimeout = window.setTimeout(() => {
            if (finished) return;
            viewer.dataset.renderState = "error";
            setStatus("图片加载超时，请点击下方链接打开文件。");
            createFallbackLink(viewer, src, fileName);
          }, 8000);

          img.onload = () => {
            finished = true;
            window.clearTimeout(imageTimeout);
            if (status) status.hidden = true;
            viewer.dataset.renderState = "done";
          };

          img.onerror = () => {
            finished = true;
            window.clearTimeout(imageTimeout);
            viewer.dataset.renderState = "error";
            setStatus("图片预览失败，请点击下方链接打开文件。");
            createFallbackLink(viewer, src, fileName);
          };

          viewer.appendChild(img);
          img.src = src;
          return;
        }

        if (ext !== "pdf") {
          viewer.dataset.renderState = "error";
          setStatus("该文件类型暂不支持内嵌预览，请点击下方链接打开。");
          createFallbackLink(viewer, src, fileName);
          return;
        }

        setStatus("PDF 加载中...");

        try {
          const pdfjsLib = await loadPdfJs();
          const task = pdfjsLib.getDocument(src);
          const pdf = await task.promise;
          const deviceScale = Math.min(window.devicePixelRatio || 1, 2);
          const targetCssWidth = Math.max(viewer.clientWidth - 20, 160);

          for (let pageNum = 1; pageNum <= pdf.numPages; pageNum += 1) {
            const page = await pdf.getPage(pageNum);
            const viewport1x = page.getViewport({ scale: 1 });
            const cssScale = targetCssWidth / viewport1x.width;
            const renderViewport = page.getViewport({ scale: cssScale * deviceScale });

            const canvas = document.createElement("canvas");
            const context = canvas.getContext("2d", { alpha: false });
            canvas.width = Math.ceil(renderViewport.width);
            canvas.height = Math.ceil(renderViewport.height);
            canvas.style.width = "100%";
            canvas.style.height = "auto";

            const pageShell = document.createElement("div");
            pageShell.className = "pdf-page";
            pageShell.appendChild(canvas);
            viewer.appendChild(pageShell);

            await page.render({ canvasContext: context, viewport: renderViewport }).promise;
          }

          if (status) status.hidden = true;
          viewer.dataset.renderState = "done";
        } catch (error) {
          console.error(error);
          viewer.dataset.renderState = "error";
          setStatus("移动端预览失败，请点击下方链接打开 PDF。");
          createFallbackLink(viewer, src, fileName);
        }
      };

      document.querySelectorAll("details.file-item").forEach((item) => {
        const viewer = item.querySelector(".pdf-viewer[data-pdf-src]");
        if (!viewer) return;

        const src = getPdfSrc(viewer);
        const fileName = getFileNameFromSrc(src);
        const ext = getFileExt(src);
        item.querySelectorAll("[data-from-src]").forEach((node) => {
          node.textContent = fileName;
        });
        const status = viewer.querySelector(".pdf-status");
        if (status) {
          status.textContent = isImageExt(ext) ? "展开后加载图片预览..." : "展开后加载 PDF 预览...";
        }

        item.addEventListener("toggle", () => {
          if (!item.open) return;
          renderPreview(viewer);
        });

        if (item.open) renderPreview(viewer);
      });

      const backToTopBtn = document.getElementById("backToTop");
      if (backToTopBtn) {
        backToTopBtn.addEventListener("click", () => {
          window.scrollTo({ top: 0, behavior: "smooth" });
        });
      }
    </script>
  </body>
</html>
