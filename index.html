<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Zhentao Fan | Works</title>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600&family=Source+Serif+4:opsz,wght@8..60,500;8..60,600&display=swap");

      :root {
        --bg: #ffffff;
        --text: #1f2937;
        --muted: #5b6473;
        --line: #e5e7eb;
        --link: #1f4fa5;
        --panel: #fafbfc;
      }

      * {
        box-sizing: border-box;
      }

      html {
        scroll-behavior: smooth;
      }

      body {
        margin: 0;
        background: var(--bg);
        color: var(--text);
        font-family: "IBM Plex Sans", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif;
        line-height: 1.75;
      }

      .page {
        width: min(940px, 92vw);
        margin: 30px auto 68px;
      }

      .topbar {
        display: flex;
        align-items: flex-start;
        justify-content: space-between;
        gap: 20px;
        border-bottom: 1px solid var(--line);
        padding: 10px 0 14px;
      }

      .identity {
        display: flex;
        flex-direction: column;
        gap: 2px;
      }

      .brand {
        font-family: "Source Serif 4", "Songti SC", serif;
        font-size: 1.4rem;
        font-weight: 600;
        letter-spacing: 0.2px;
      }

      .identity-contact {
        color: var(--muted);
        font-size: 0.92rem;
        line-height: 1.5;
      }

      .identity-contact a {
        color: var(--link);
        text-decoration: none;
      }

      .identity-contact a:hover {
        text-decoration: underline;
      }

      .topbar nav {
        display: flex;
        gap: 18px;
        flex-wrap: wrap;
      }

      .topbar nav a {
        color: var(--muted);
        text-decoration: none;
        font-size: 0.95rem;
      }

      .topbar nav a:hover {
        color: var(--link);
      }

      .hero {
        padding: 10px 0 8px;
      }

      .hero h2 {
        margin: 0;
        font-family: "Source Serif 4", "Songti SC", serif;
        font-size: clamp(1.5rem, 4.2vw, 2rem);
        line-height: 1.15;
        font-weight: 600;
      }

      .hero p {
        margin: 14px 0 0;
        max-width: 76ch;
        color: var(--muted);
      }

      .section-title {
        margin: 10px 0 8px;
        font-family: "Source Serif 4", "Songti SC", serif;
        font-size: clamp(1.45rem, 3vw, 1.55rem);
        font-weight: 600;
      }

      .works-intro {
        margin: 0 0 8px;
        color: var(--muted);
      }

      .works {
        border-top: 1px solid var(--line);
      }

      .work-entry {
        padding: 16px 0;
        border-bottom: 1px solid var(--line);
      }

      summary {
        list-style: none;
        cursor: pointer;
        padding: 16px 0;
        display: flex;
        align-items: baseline;
        justify-content: space-between;
        gap: 16px;
      }

      summary::-webkit-details-marker {
        display: none;
      }

      .work-title-wrap {
        min-width: 0;
      }

      .work-title {
        font-size: 1.05rem;
        font-weight: 600;
        color: var(--text);
      }

      .work-date {
        color: #9ca3af;
        font-weight: 500;
      }

      .work-desc {
        margin-top: 4px;
        color: var(--muted);
        font-size: 0.95rem;
      }

      .work-desc a {
        color: #6b7280;
        text-decoration: none;
      }

      .work-desc a:hover {
        color: #4b5563;
        text-decoration: underline;
      }

      .file-list {
        margin-top: 8px;
      }

      details.file-item {
        border: 1px solid var(--line);
        border-radius: 8px;
        background: #fff;
      }

      details.file-item + details.file-item {
        margin-top: 10px;
      }

      details.file-item summary {
        padding: 10px 12px;
      }

      .file-name {
        font-size: 0.95rem;
        color: #6b7280;
        word-break: break-all;
      }

      .toggle-mark {
        flex: 0 0 auto;
        color: var(--link);
        font-size: 1.1rem;
        font-weight: 600;
        transition: transform 0.2s ease;
      }

      details[open] .toggle-mark {
        transform: rotate(90deg);
      }

      .pdf-viewer {
        width: 100%;
        margin: 0 12px 12px;
        border: 1px solid #d8dce3;
        border-radius: 8px;
        background: #fff;
        padding: 10px;
        min-height: 120px;
      }

      .pdf-status {
        margin: 0;
        color: #6b7280;
        font-size: 0.9rem;
      }

      .pdf-page {
        margin-top: 10px;
        border: 1px solid #e5e7eb;
        border-radius: 6px;
        overflow: hidden;
        background: #fff;
      }

      .pdf-page canvas {
        display: block;
        width: 100%;
        height: auto;
      }

      .pdf-fallback {
        margin: 10px 0 0;
        font-size: 0.9rem;
      }

      .pdf-fallback a {
        color: #6b7280;
        text-decoration: underline;
      }

      @media (max-width: 760px) {
        .page {
          margin-top: 18px;
        }

        .topbar {
          flex-direction: column;
          align-items: flex-start;
          gap: 8px;
        }
      }
    </style>
  </head>
  <body>
    <main class="page">
      <header class="topbar">
        <div class="identity">
          <div class="brand">Zhentao Fan</div>
          <div class="identity-contact" id="contact">
            多伦多大学本硕，两年修满学分，本科生讲师
          </div>
          <div class="identity-contact" id="contact">
            Contact:
            <a href="mailto:zhentao.fan@alumni.utoronto.ca">zhentao.fan@alumni.utoronto.ca</a>
          </div>
        </div>
        <nav aria-label="Main">
          <a href="#about">About</a>
          <a href="#works">Works</a>
          <a href="#contact">Contact</a>
        </nav>
      </header>

      <section class="hero" id="about">
        <h2>Open-Sourced Innovation</h2>
        <!-- <p>
          研究方向：
          训练并行框架，算子优化，长程多轮RL
        </p> -->
      </section>

      <section id="works">
        <h2 class="section-title">落地项目</h2>
        <!-- <p class="works-intro">占位符。</p> -->

        <div class="works">
          <article class="work-entry">
            <div class="work-title-wrap">
              <div class="work-title">【创新｜独作】Mamba Context Parallel <span class="work-date">[2025/05｜华为加研院TechSpark年度创新银奖]</span></div>
              <div class="work-desc">Mamba2 上下文并行算法： 预训练加速10%～20%，无限上下文训练，可与现有TPSP方法叠加。<a href="https://gitcode.com/Ascend/MindSpeed-LLM/blob/2.3.0/mindspeed_llm/tasks/models/ssm/state_space_context_parallel.py" target="_blank" rel="noopener">[代码]</a></div>
            </div>
            <div class="file-list">
              <details class="file-item">
                <summary>
                  <span class="file-name" data-from-src></span>
                  <span class="toggle-mark">▶</span>
                </summary>
                <div class="pdf-viewer" data-pdf-src="./MambaCP特性讲解.pdf">
                  <p class="pdf-status">展开后加载 PDF 预览...</p>
                </div>
              </details>
            </div>
          </article>

          <article class="work-entry">
            <div class="work-title-wrap">
              <div class="work-title">【优化｜合著】昇腾 MLA PageAttention Int8算子 <span class="work-date">[2025/04]</span></div>
              <div class="work-desc">MLA推理算子：C8算子加速160%，16比特算子加速20%。<a href="https://gitcode.com/cann/ascend-transformer-boost/blob/br_release_cann_8.3.RC1_20260322/src/kernels/mixkernels/multi_latent_attention/op_kernel/mla_int8.cce" target="_blank" rel="noopener">[代码]</a></div>
            </div>
            <div class="file-list">
              <details class="file-item">
                <summary>
                  <span class="file-name" data-from-src></span>
                  <span class="toggle-mark">▶</span>
                </summary>
                <div class="pdf-viewer" data-pdf-src="./DeepSeek-C8优化讲解.pdf">
                  <p class="pdf-status">展开后加载 PDF 预览...</p>
                </div>
              </details>
              <details class="file-item">
                <summary>
                  <span class="file-name" data-from-src></span>
                  <span class="toggle-mark">▶</span>
                </summary>
                <div class="pdf-viewer" data-pdf-src="./MLA-PageAtten-MTP优化讲解.pdf">
                  <p class="pdf-status">展开后加载 PDF 预览...</p>
                </div>
              </details>
            </div>
          </article>

          <article class="work-entry">
            <div class="work-title-wrap">
              <div class="work-title">【创新｜独作】ZeCO-HDP <span class="work-date">[2025/12]</span></div>
              <div class="work-desc">RL场景，长短序列混合CP并行：训练后端加速10～20%，峰值Tokens负载更低。<a href="https://gitcode.com/cann/cann-recipes-train/pull/89" target="_blank" rel="noopener">[代码]</a></div>
            </div>
            <div class="file-list">
              <details class="file-item">
                <summary>
                  <span class="file-name" data-from-src></span>
                  <span class="toggle-mark">▶</span>
                </summary>
                <div class="pdf-viewer" data-pdf-src="./ZeCO-HDP优化讲解.pdf">
                  <p class="pdf-status">展开后加载 PDF 预览...</p>
                </div>
              </details>
            </div>
          </article>

        </div>
      </section>
    </main>

    <script>
      const getFileNameFromSrc = (src) => {
        const path = (src || "").split("#")[0].split("?")[0];
        const tail = path.substring(path.lastIndexOf("/") + 1);
        try {
          return decodeURIComponent(tail);
        } catch {
          return tail;
        }
      };

      const getPdfSrc = (viewer) => viewer.getAttribute("data-pdf-src") || "";

      let pdfJsLoader;
      const loadPdfJs = () => {
        if (window.pdfjsLib) return Promise.resolve(window.pdfjsLib);
        if (!pdfJsLoader) {
          pdfJsLoader = new Promise((resolve, reject) => {
            const script = document.createElement("script");
            script.src = "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js";
            script.onload = () => {
              if (!window.pdfjsLib) {
                reject(new Error("PDF.js is unavailable"));
                return;
              }
              window.pdfjsLib.GlobalWorkerOptions.workerSrc =
                "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";
              resolve(window.pdfjsLib);
            };
            script.onerror = () => reject(new Error("Failed to load PDF.js"));
            document.head.appendChild(script);
          });
        }
        return pdfJsLoader;
      };

      const createFallbackLink = (viewer, src, fileName) => {
        if (viewer.querySelector(".pdf-fallback")) return;
        const row = document.createElement("p");
        row.className = "pdf-fallback";
        const link = document.createElement("a");
        link.href = src;
        link.target = "_blank";
        link.rel = "noopener";
        link.textContent = `打开 ${fileName}`;
        row.appendChild(link);
        viewer.appendChild(row);
      };

      const renderPdf = async (viewer) => {
        if (viewer.dataset.renderState === "loading" || viewer.dataset.renderState === "done") return;
        const src = getPdfSrc(viewer);
        if (!src) return;

        const status = viewer.querySelector(".pdf-status");
        const setStatus = (text) => {
          if (!status) return;
          status.textContent = text;
          status.hidden = false;
        };

        viewer.dataset.renderState = "loading";
        setStatus("PDF 加载中...");

        try {
          const pdfjsLib = await loadPdfJs();
          const task = pdfjsLib.getDocument(src);
          const pdf = await task.promise;
          const deviceScale = Math.min(window.devicePixelRatio || 1, 2);
          const targetCssWidth = Math.max(viewer.clientWidth - 22, 280);
          viewer.querySelectorAll(".pdf-page").forEach((node) => node.remove());
          viewer.querySelectorAll(".pdf-fallback").forEach((node) => node.remove());

          for (let pageNum = 1; pageNum <= pdf.numPages; pageNum += 1) {
            const page = await pdf.getPage(pageNum);
            const viewport1x = page.getViewport({ scale: 1 });
            const cssScale = targetCssWidth / viewport1x.width;
            const renderViewport = page.getViewport({ scale: cssScale * deviceScale });

            const canvas = document.createElement("canvas");
            const context = canvas.getContext("2d", { alpha: false });
            canvas.width = Math.ceil(renderViewport.width);
            canvas.height = Math.ceil(renderViewport.height);
            canvas.style.width = `${Math.ceil(renderViewport.width / deviceScale)}px`;
            canvas.style.height = `${Math.ceil(renderViewport.height / deviceScale)}px`;

            const pageShell = document.createElement("div");
            pageShell.className = "pdf-page";
            pageShell.appendChild(canvas);
            viewer.appendChild(pageShell);

            await page.render({ canvasContext: context, viewport: renderViewport }).promise;
          }

          if (status) status.hidden = true;
          viewer.dataset.renderState = "done";
        } catch (error) {
          console.error(error);
          viewer.dataset.renderState = "error";
          const fileName = getFileNameFromSrc(src);
          setStatus("移动端预览失败，请点击下方链接打开 PDF。");
          createFallbackLink(viewer, src, fileName);
        }
      };

      document.querySelectorAll("details.file-item").forEach((item) => {
        const viewer = item.querySelector(".pdf-viewer[data-pdf-src]");
        if (!viewer) return;

        const fileName = getFileNameFromSrc(getPdfSrc(viewer));
        item.querySelectorAll("[data-from-src]").forEach((node) => {
          node.textContent = fileName;
        });

        item.addEventListener("toggle", () => {
          if (!item.open) return;
          renderPdf(viewer);
        });

        if (item.open) renderPdf(viewer);
      });
    </script>
  </body>
</html>
